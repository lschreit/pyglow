cmake_minimum_required(VERSION 3.13)
project(pyglow VERSION 0.1.0 LANGUAGES C Fortran)

find_package(PythonExtensions REQUIRED)
find_package(NumPy REQUIRED)
find_package(Python COMPONENTS Interpreter Development REQUIRED)

include_directories(${NUMPY_INCLUDE_DIRS})

set(DL_MODELS "src/pyglow/models/dl_models")
set(PYTHON_SITE_PACKAGES )

# IGRF 11
Python_add_library(igrf11py MODULE
  ${DL_MODELS}/igrf11/igrf11_modified.f
  ${DL_MODELS}/igrf11/sig_file_patched.pyf
)
target_compile_options(igrf11py PRIVATE -std=legacy)
target_include_directories(igrf11py PRIVATE ${NUMPY_INCLUDE_DIRS})

# IGRF 12
Python_add_library(igrf12py MODULE
  ${DL_MODELS}/igrf12/igrf12_modified.f
  ${DL_MODELS}/igrf12/sig_file_patched.pyf
)
target_compile_options(igrf12py PRIVATE -std=legacy)
target_include_directories(igrf12py PRIVATE ${NUMPY_INCLUDE_DIRS})

# HWM 93
Python_add_library(hwm93py MODULE
  ${DL_MODELS}/hwm93/hwm93_modified.f
  ${DL_MODELS}/hwm93/sig_file_patched.pyf
)
target_compile_options(hwm93py PRIVATE -std=legacy)
target_include_directories(hwm93py PRIVATE ${NUMPY_INCLUDE_DIRS})

# HWM 07
Python_add_library(hwm07py MODULE
  ${DL_MODELS}/hwm07/hwm07e_modified.f90
  ${DL_MODELS}/hwm07/apexcord.f90
  ${DL_MODELS}/hwm07/sig_file.pyf
)
target_compile_options(hwm07py PRIVATE -std=legacy)
target_include_directories(hwm07py PRIVATE ${NUMPY_INCLUDE_DIRS})

# HWM 14
Python_add_library(hwm14py MODULE
  ${DL_MODELS}/hwm14/hwm14.f90
  ${DL_MODELS}/hwm14/sig_file.pyf
)
target_compile_options(hwm14py PRIVATE -std=legacy)
target_include_directories(hwm14py PRIVATE ${NUMPY_INCLUDE_DIRS})

# IRI 12
Python_add_library(iri12py MODULE
  ${DL_MODELS}/iri12/cira.for
  ${DL_MODELS}/iri12/igrf.for
  ${DL_MODELS}/iri12/iridreg_modified.for
  ${DL_MODELS}/iri12/irifun.for
  ${DL_MODELS}/iri12/irisub.for
  ${DL_MODELS}/iri12/iritec.for
  ${DL_MODELS}/iri12/iriflip.for
  ${DL_MODELS}/iri12/sig_file_patched.pyf
)
target_compile_options(iri12py PRIVATE -std=legacy -w -O2 -fbacktrace -fno-automatic -fPIC)
target_include_directories(iri12py PRIVATE ${NUMPY_INCLUDE_DIRS})

# IRI 16
Python_add_library(iri16py MODULE
  ${DL_MODELS}/iri16/cira.for
  ${DL_MODELS}/iri16/igrf.for
  ${DL_MODELS}/iri16/iridreg_modified.for
  ${DL_MODELS}/iri16/irifun.for
  ${DL_MODELS}/iri16/irisub.for
  ${DL_MODELS}/iri16/iritec.for
  ${DL_MODELS}/iri16/iriflip_modified.for
  ${DL_MODELS}/iri16/cosd_sind.for
  ${DL_MODELS}/iri16/sig_file_patched.pyf
)
target_compile_options(iri16py PRIVATE -std=legacy -w -O2 -fbacktrace -fno-automatic -fPIC)
target_include_directories(iri16py PRIVATE ${NUMPY_INCLUDE_DIRS})

# MSIS 00
Python_add_library(msis00py MODULE
  ${DL_MODELS}/msis/nrlmsise00_sub_patched.for
  ${DL_MODELS}/msis/sig_file_patched.pyf
)
target_compile_options(msis00py PRIVATE -std=legacy)
target_include_directories(msis00py PRIVATE ${NUMPY_INCLUDE_DIRS})

install(TARGETS igrf11py igrf12py hwm93py hwm07py hwm14py iri12py iri16py msis00py LIBRARY DESTINATION pyglow)